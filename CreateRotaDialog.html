<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        color: #333;
      }
      
      .container {
        max-width: 500px;
        margin: 0 auto;
      }
      
      h2 {
        color: #1a73e8;
        margin-bottom: 20px;
      }
      
      .option-group {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
      }
      
      .option-group h3 {
        margin-top: 0;
        color: #202124;
      }
      
      .form-group {
        margin-bottom: 15px;
      }
      
      label {
        font-weight: 500;
      }
      
      select, input {
        width: 100%;
        padding: 8px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-size: 14px;
      }
      
      /* Specific styles for radio buttons and checkboxes */
      .form-group input[type="radio"],
      .form-group input[type="checkbox"] {
        width: auto; /* Override 100% width for radio/checkbox */
        margin-right: 8px;
      }
      
      /* Styling for Select Creation Mode section */
      .creation-mode-form-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      
      .creation-mode-label {
        display: flex;
        align-items: center;
      }

      /* Styling for Staff Import section */
      .staff-import-label {
        display: flex;
        align-items: center;
      }
      
      .month-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      
      .month-checkbox {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      .month-checkbox input {
        width: auto;
      }
      
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      
      button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s;
      }
      
      .primary-button {
        background-color: #1a73e8;
        color: white;
      }
      
      .primary-button:hover {
        background-color: #1557b0;
      }
      
      .primary-button:disabled {
        background-color: #aecbfa;
        cursor: not-allowed;
      }
      
      .secondary-button {
        background-color: #f1f3f4;
        color: #202124;
      }
      
      .secondary-button:hover {
        background-color: #e8eaed;
      }
      
      .message-container {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        display: none;
      }
      
      .error-message {
        background-color: #fce8e6;
        border: 1px solid #fad2cf;
        color: #d93025;
      }
      
      .success-message {
        background-color: #e6f4ea;
        border: 1px solid #ceead6;
        color: #137333;
      }
      
      .loading-message {
        background-color: #e8f0fe;
        border: 1px solid #d2e3fc;
        color: #1a73e8;
      }
      
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #1a73e8;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
        vertical-align: middle;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .message-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .message-icon {
        font-size: 20px;
      }
      
      .message-text {
        flex-grow: 1;
      }
      
      .progress-bar {
        width: 100%;
        height: 4px;
        background-color: #e8eaed;
        border-radius: 2px;
        margin-top: 10px;
        overflow: hidden;
        display: none;
      }
      
      .progress-bar-fill {
        height: 100%;
        background-color: #1a73e8;
        width: 0%;
        transition: width 0.3s ease;
      }
      
      .sheet-list {
        margin-top: 10px;
        padding-left: 20px;
      }
      
      .sheet-list li {
        margin: 5px 0;
      }
      
      .sheet-list .created {
        color: #137333;
      }
      
      .sheet-list .skipped {
        color: #f29900;
      }
      
      .sheet-list .failed {
        color: #d93025;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Create Rota Sheets</h2>
      
      <div class="option-group">
        <h3>Select Creation Mode</h3>
        <div class="form-group creation-mode-form-group">
          <label class="creation-mode-label">
            <input type="radio" name="creationMode" value="single" checked onchange="toggleCreationMode()">
            Single Month
          </label>
          <label class="creation-mode-label">
            <input type="radio" name="creationMode" value="multiple" onchange="toggleCreationMode()">
            Multiple Months
          </label>
        </div>
      </div>
      
      <!-- Staff Import Option -->
      <div class="option-group">
        <h3>Staff Import</h3>
        <div class="form-group">
          <label class="staff-import-label">
            <input type="checkbox" id="importStaffCheckbox" checked>
            Import staff members into new sheets
          </label>
        </div>
      </div>
      
      <!-- Single Month Form -->
      <div id="singleMonthForm" class="option-group">
        <h3>Create Single Month Rota</h3>
        <div class="form-group">
          <label for="singleMonth">Month:</label>
          <select id="singleMonth" required>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
          </select>
        </div>
        <div class="form-group">
          <label for="singleYear">Year:</label>
          <input type="number" id="singleYear" min="2000" max="3000" value="2024" required>
        </div>
      </div>
      
      <!-- Multiple Months Form -->
      <div id="multipleMonthsForm" class="option-group" style="display: none;">
        <h3>Create Multiple Month Rotas</h3>
        <div class="form-group">
          <label for="multipleYear">Year:</label>
          <input type="number" id="multipleYear" min="2000" max="3000" value="2024" required>
        </div>
        <div class="form-group">
          <label>Select Months:</label>
          <div class="month-grid">
            <div class="month-checkbox">
              <input type="checkbox" id="month1" value="1">
              <label for="month1">January</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month2" value="2">
              <label for="month2">February</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month3" value="3">
              <label for="month3">March</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month4" value="4">
              <label for="month4">April</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month5" value="5">
              <label for="month5">May</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month6" value="6">
              <label for="month6">June</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month7" value="7">
              <label for="month7">July</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month8" value="8">
              <label for="month8">August</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month9" value="9">
              <label for="month9">September</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month10" value="10">
              <label for="month10">October</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month11" value="11">
              <label for="month11">November</label>
            </div>
            <div class="month-checkbox">
              <input type="checkbox" id="month12" value="12">
              <label for="month12">December</option>
            </div>
          </div>
        </div>
        <div class="form-group">
          <button type="button" class="secondary-button" onclick="selectAllMonths()">Select All</button>
          <button type="button" class="secondary-button" onclick="deselectAllMonths()">Deselect All</button>
        </div>
      </div>
      
      <div class="button-group">
        <button type="button" id="createButton" class="primary-button" onclick="createRotaSheets()">Create Rota Sheets</button>
        <button type="button" class="secondary-button" onclick="google.script.host.close()">Cancel</button>
      </div>
      
      <div id="message" class="message-container"></div>
      <div id="progressBar" class="progress-bar">
        <div class="progress-bar-fill"></div>
      </div>
    </div>
    
    <script>
      function toggleCreationMode() {
        const singleForm = document.getElementById('singleMonthForm');
        const multipleForm = document.getElementById('multipleMonthsForm');
        const mode = document.querySelector('input[name="creationMode"]:checked').value;
        
        if (mode === 'single') {
          singleForm.style.display = 'block';
          multipleForm.style.display = 'none';
        } else {
          singleForm.style.display = 'none';
          multipleForm.style.display = 'block';
        }
      }
      
      function selectAllMonths() {
        const checkboxes = document.querySelectorAll('.month-checkbox input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = true);
      }
      
      function deselectAllMonths() {
        const checkboxes = document.querySelectorAll('.month-checkbox input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = false);
      }
      
      function showLoading(message) {
        const messageDiv = document.getElementById('message');
        const progressBar = document.getElementById('progressBar');
        const createButton = document.getElementById('createButton');
        
        messageDiv.className = 'message-container loading-message';
        messageDiv.style.display = 'block';
        messageDiv.innerHTML = `
          <div class="message-content">
            <div class="spinner"></div>
            <div class="message-text">${message}</div>
          </div>
        `;
        
        progressBar.style.display = 'block';
        createButton.disabled = true;
      }
      
      function showError(message) {
        const messageDiv = document.getElementById('message');
        const progressBar = document.getElementById('progressBar');
        const createButton = document.getElementById('createButton');
        
        messageDiv.className = 'message-container error-message';
        messageDiv.style.display = 'block';
        messageDiv.innerHTML = `
          <div class="message-content">
            <div class="message-icon">‚ö†Ô∏è</div>
            <div class="message-text">${message}</div>
          </div>
        `;
        
        progressBar.style.display = 'none';
        createButton.disabled = false;
      }
      
      function showSuccess(result) {
        const messageDiv = document.getElementById('message');
        const progressBar = document.getElementById('progressBar');
        const createButton = document.getElementById('createButton');
        
        messageDiv.className = 'message-container success-message';
        messageDiv.style.display = 'block';
        
        let content = `
          <div class="message-content">
            <div class="message-icon">‚úÖ</div>
            <div class="message-text">
              <div>${result.message}</div>
        `;
        
        if (result.created && result.created.length > 0) {
          content += `
            <div class="sheet-list">
              <div>Created sheets:</div>
              <ul>
                ${result.created.map(sheet => `<li class="created">üìã ${sheet}</li>`).join('')}
              </ul>
            </div>
          `;
        }
        
        if (result.skipped && result.skipped.length > 0) {
          content += `
            <div class="sheet-list">
              <div>Skipped existing sheets:</div>
              <ul>
                ${result.skipped.map(sheet => `<li class="skipped">üìÑ ${sheet}</li>`).join('')}
              </ul>
            </div>
          `;
        }
        
        if (result.failed && result.failed.length > 0) {
          content += `
            <div class="sheet-list">
              <div>Failed to create:</div>
              <ul>
                ${result.failed.map(sheet => `<li class="failed">‚ùå ${sheet}</li>`).join('')}
              </ul>
            </div>
          `;
        }
        
        content += `
            </div>
          </div>
        `;
        
        messageDiv.innerHTML = content;
        progressBar.style.display = 'none';
        createButton.disabled = false;
        
        // Auto-close after 3 seconds if everything was successful
        if (!result.failed || result.failed.length === 0) {
          setTimeout(() => google.script.host.close(), 3000);
        }
      }
      
      function createRotaSheets() {
        const mode = document.querySelector('input[name="creationMode"]:checked').value;
        const importStaff = document.getElementById('importStaffCheckbox').checked;
        const messageDiv = document.getElementById('message');
        messageDiv.innerHTML = '';
        
        if (mode === 'single') {
          const month = parseInt(document.getElementById('singleMonth').value);
          const year = parseInt(document.getElementById('singleYear').value);
          
          if (!validateYear(year)) {
            showError('Please enter a valid year between 2000 and 3000');
            return;
          }
          
          showLoading('Creating rota sheet...');
          
          google.script.run
            .withSuccessHandler(function(result) {
              if (result.success) {
                showSuccess(result);
              } else {
                showError(result.message);
              }
            })
            .withFailureHandler(function(error) {
              showError('Error creating rota sheet: ' + error.message);
            })
            .createRotaSheetFromDialog('single', { 
              month: month, 
              year: year,
              importStaff: importStaff 
            });
            
        } else {
          const year = parseInt(document.getElementById('multipleYear').value);
          const selectedMonths = [];
          
          document.querySelectorAll('.month-checkbox input[type="checkbox"]:checked').forEach(checkbox => {
            selectedMonths.push(parseInt(checkbox.value));
          });

          if (!validateYear(year)) {
            showError('Please enter a valid year between 2000 and 3000');
            return;
          }
          
          if (selectedMonths.length === 0) {
            showError('Please select at least one month');
            return;
          }
          
          showLoading(`Creating ${selectedMonths.length} rota sheets...`);
          
          google.script.run
            .withSuccessHandler(function(result) {
              if (result.success) {
                showSuccess(result);
              } else {
                showError(result.message);
              }
            })
            .withFailureHandler(function(error) {
              showError('Error creating rota sheets: ' + error.message);
            })
            .createRotaSheetFromDialog('multiple', { 
              year: year, 
              months: selectedMonths,
              importStaff: importStaff 
            });
        }
      }
      
      function validateYear(year) {
        return !isNaN(year) && year >= 2000 && year <= 3000;
      }
      
      // Initialize with current year
      document.addEventListener('DOMContentLoaded', function() {
        const currentYear = new Date().getFullYear();
        document.getElementById('singleYear').value = currentYear;
        document.getElementById('multipleYear').value = currentYear;
      });
    </script>
  </body>
</html> 